<!DOCTYPE html>
<html lang="en">

<head>
 <title>Syntropic Farming Admin Panel</title>
</head>

<body>
  <h1>Species-Material Association</h1>

  <form id="createAssociationForm">
    <select id="speciesSelect" name="species">
      <option>Choose a species</option>
    </select>
    <select id="materialSelect" name="material">
      <option>Choose a material</option>
    </select>
    <br/>
    <br/>
    image: <input type="file" name="image" />
    <br/>
    <br/>
    link: <input type="text" name="link" id="link"/>
    <br/>
    <br/>
    <input type="submit" value="create" />
  </form>

  <script>
    document.getElementById('createAssociationForm').addEventListener('submit', createAssociation)

    speciesSelect = document.getElementById("speciesSelect")
    materialSelect = document.getElementById("materialSelect")
    
    getMaterialList()
    getSpecies()

    function getMaterialList() {
      fetch("/api/materials")
        .then(response => response.json())
        .then(materials => {
          materials.forEach(material => {
            var el = document.createElement("option");
            el.textContent = material.name;
            el.value = material.id;
            materialSelect.appendChild(el);
          });
        })
    }

    function getSpecies() {
      fetch("/api/species")
        .then(response => response.json())
        .then(speciesList => {
          speciesList.forEach(species => {
            var el = document.createElement("option");
            el.textContent = species.name;
            el.value = species.id;
            speciesSelect.appendChild(el);
          });
        })
    }

    function createAssociation(event) {
      event.preventDefault();
      form = document.getElementById('createAssociationForm')
      const formData = new FormData(form);

      fetch("/api/associations/create", {
          method: "POST",
          mode: "cors",
          cache: "no-cache", 
          credentials: "same-origin",
          redirect: "follow",
          referrer: "no-referrer",
          body: formData
        })
        .then(response => console.log("association created"));
    }
  </script>

</body>
</html>